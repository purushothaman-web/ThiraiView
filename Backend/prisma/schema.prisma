// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model CachedMovie {
  id               Int      @id @default(autoincrement())
  source           String
  sourceMovieId    Int
  sourceId         String   @unique
  title            String
  overview         String?
  runtime          Int?
  releaseDate      DateTime?
  posterPath       String?
  backdropPath     String?
  voteAverage      Float?
  voteCount        Int?
  originalLanguage String?
  genresJson       String?
  languagesJson    String?
  creditsJson      String?
  providersJson    String?
  rawJson          String?
  fetchedAt        DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@unique([source, sourceMovieId], name: "source_sourceMovieId")
  @@index([title])
  @@index([fetchedAt])
}

model CachedSearch {
  id         Int      @id @default(autoincrement())
  key        String   @unique
  query      String
  page       Int      @default(1)
  region     String   @default("IN")
  language   String   @default("en-US")
  year       Int?
  genre      Int?
  payloadJson String
  fetchedAt  DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([query])
  @@index([fetchedAt])
}

model CachedAutocomplete {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  query       String
  limit       Int      @default(10)
  language    String   @default("en-US")
  payloadJson String
  fetchedAt   DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([query])
  @@index([fetchedAt])
}

model CacheMeta {
  id         Int      @id @default(autoincrement())
  key        String   @unique
  version    Int      @default(1)
  payloadJson String?
  fetchedAt  DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
